{% extends 'gestion/base.html' %}

{% block title %}Mis Reservas - Sistema de GestiÃ³n Vecinal{% endblock %}

{% block content %}
<div class="content-container">
    <h1>ğŸ“‹ Mis Reservas</h1>
    
    <div style="margin-bottom: 20px;">
        <a href="{% url 'listar_espacios' %}" class="btn btn-secondary">â† Volver a Espacios</a>
        <a href="{% url 'solicitar_reserva' %}" class="btn btn-success">â• Nueva Reserva</a>
        <a href="{% url 'calendario_reservas' %}" class="btn btn-info">ğŸ“… Ver Calendario</a>
    </div>
    
    {% if reservas %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Espacio</th>
                <th>Fecha</th>
                <th>Horario</th>
                <th>Personas</th>
                <th>Estado</th>
                <th>Fecha Solicitud</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for reserva in reservas %}
            <tr>
                <td>
                    {% if reserva.espacio.tipo == 'cancha' %}ğŸ€
                    {% elif reserva.espacio.tipo == 'sala' %}ğŸ¢
                    {% elif reserva.espacio.tipo == 'plaza' %}ğŸŒ³
                    {% endif %}
                    {{ reserva.espacio.nombre }}
                </td>
                <td>{{ reserva.fecha|date:"d/m/Y" }}</td>
                <td>{{ reserva.get_horario_display }}</td>
                <td>{{ reserva.cantidad_personas }}</td>
                <td>
                    {% if reserva.estado == 'pendiente' %}
                        <span class="badge badge-warning">â³ Pendiente</span>
                    {% elif reserva.estado == 'aprobada' %}
                        <span class="badge badge-success">âœ… Aprobada</span>
                    {% elif reserva.estado == 'rechazada' %}
                        <span class="badge badge-danger">âŒ Rechazada</span>
                    {% elif reserva.estado == 'cancelada' %}
                        <span class="badge badge-secondary">ğŸš« Cancelada</span>
                    {% endif %}
                </td>
                <td>{{ reserva.fecha_solicitud|date:"d/m/Y H:i" }}</td>
                <td>
                    <button type="button" class="btn btn-info btn-sm" onclick="verDetalle{{ reserva.id }}()">ğŸ‘ï¸ Ver</button>
                    {% if reserva.estado == 'pendiente' or reserva.estado == 'aprobada' %}
                    <form method="post" action="{% url 'cancelar_reserva' reserva.id %}" style="display: inline;" onsubmit="return confirm('Â¿EstÃ¡ seguro de cancelar esta reserva?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">ğŸš« Cancelar</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            <tr id="detalle{{ reserva.id }}" style="display: none;">
                <td colspan="7" style="background: #f8f9fa; padding: 20px;">
                    <h4>Detalles de la Reserva</h4>
                    <p><strong>Motivo:</strong> {{ reserva.motivo }}</p>
                    <p><strong>Capacidad del espacio:</strong> {{ reserva.espacio.capacidad }} personas</p>
                    {% if reserva.fecha_respuesta %}
                    <p><strong>Fecha de respuesta:</strong> {{ reserva.fecha_respuesta|date:"d/m/Y H:i" }}</p>
                    {% endif %}
                    {% if reserva.observaciones_admin %}
                    <p><strong>Observaciones del administrador:</strong> {{ reserva.observaciones_admin }}</p>
                    {% endif %}
                </td>
            </tr>
            <script>
            function verDetalle{{ reserva.id }}() {
                var detalle = document.getElementById('detalle{{ reserva.id }}');
                if (detalle.style.display === 'none') {
                    detalle.style.display = 'table-row';
                } else {
                    detalle.style.display = 'none';
                }
            }
            </script>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-data">No tiene reservas registradas.</p>
    <p style="text-align: center; margin-top: 20px;">
        <a href="{% url 'solicitar_reserva' %}" class="btn btn-success">â• Solicitar Primera Reserva</a>
    </p>
    {% endif %}
</div>

<style>
.btn {
    display: inline-block;
    padding: 8px 16px;
    margin: 2px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-size: 13px;
}
.btn-success {
    background-color: #27ae60;
    color: white;
}
.btn-secondary {
    background-color: #95a5a6;
    color: white;
}
.btn-info {
    background-color: #3498db;
    color: white;
}
.btn-danger {
    background-color: #e74c3c;
    color: white;
}
.btn-sm {
    padding: 6px 12px;
    font-size: 12px;
}
.btn:hover {
    opacity: 0.9;
}
.badge {
    padding: 5px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}
.badge-warning {
    background-color: #f39c12;
    color: white;
}
.badge-success {
    background-color: #27ae60;
    color: white;
}
.badge-danger {
    background-color: #e74c3c;
    color: white;
}
.badge-secondary {
    background-color: #95a5a6;
    color: white;
}
</style>
{% endblock %}
