{% extends 'gestion/base.html' %}

{% block title %}Gestionar Reservas - Sistema de Gesti√≥n Vecinal{% endblock %}

{% block content %}
<div class="content-container">
    <h1>üè¢ Gestionar Reservas de Espacios</h1>
    
    <div style="margin-bottom: 20px;">
        <a href="{% url 'calendario_reservas' %}" class="btn btn-info">üìÖ Ver Calendario</a>
    </div>
    
    {% if reservas %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Vecino</th>
                <th>Espacio</th>
                <th>Fecha</th>
                <th>Horario</th>
                <th>Personas</th>
                <th>Estado</th>
                <th>Solicitud</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for reserva in reservas %}
            <tr>
                <td>{{ reserva.vecino.nombre }} {{ reserva.vecino.apellido }}</td>
                <td>
                    {% if reserva.espacio.tipo == 'cancha' %}üèÄ
                    {% elif reserva.espacio.tipo == 'sala' %}üè¢
                    {% elif reserva.espacio.tipo == 'plaza' %}üå≥
                    {% endif %}
                    {{ reserva.espacio.nombre }}
                </td>
                <td>{{ reserva.fecha|date:"d/m/Y" }}</td>
                <td>{{ reserva.get_horario_display }}</td>
                <td>{{ reserva.cantidad_personas }}/{{ reserva.espacio.capacidad }}</td>
                <td>
                    {% if reserva.estado == 'pendiente' %}
                        <span class="badge badge-warning">‚è≥ Pendiente</span>
                    {% elif reserva.estado == 'aprobada' %}
                        <span class="badge badge-success">‚úÖ Aprobada</span>
                    {% elif reserva.estado == 'rechazada' %}
                        <span class="badge badge-danger">‚ùå Rechazada</span>
                    {% elif reserva.estado == 'cancelada' %}
                        <span class="badge badge-secondary">üö´ Cancelada</span>
                    {% endif %}
                </td>
                <td>{{ reserva.fecha_solicitud|date:"d/m/Y H:i" }}</td>
                <td>
                    <div style="display: flex; gap: 3px; flex-wrap: wrap; align-items: center;">
                        <button type="button" class="btn btn-info btn-sm" onclick="toggleDetalle('detalle{{ reserva.id }}')">Ver</button>
                        {% if reserva.estado == 'pendiente' %}
                        <form method="post" action="{% url 'aprobar_reserva' reserva.id %}" style="display: inline; margin: 0;" onsubmit="return confirm('¬øAprobar esta reserva?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success btn-sm">Aprobar</button>
                        </form>
                        <form method="post" action="{% url 'rechazar_reserva' reserva.id %}" style="display: inline; margin: 0;" onsubmit="return confirm('¬øRechazar esta reserva?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm">Rechazar</button>
                        </form>
                        {% endif %}
                    </div>
                </td>
            </tr>
            <tr id="detalle{{ reserva.id }}" style="display: none;">
                <td colspan="8" style="background: #f8f9fa; padding: 20px;">
                    <h4>Detalles de la Reserva</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <p><strong>Vecino:</strong> {{ reserva.vecino.nombre }} {{ reserva.vecino.apellido }}</p>
                            <p><strong>RUT:</strong> {{ reserva.vecino.rut }}</p>
                            <p><strong>Email:</strong> {{ reserva.vecino.email }}</p>
                            <p><strong>Tel√©fono:</strong> {{ reserva.vecino.telefono }}</p>
                        </div>
                        <div>
                            <p><strong>Espacio:</strong> {{ reserva.espacio.nombre }}</p>
                            <p><strong>Tipo:</strong> {{ reserva.espacio.get_tipo_display }}</p>
                            <p><strong>Capacidad:</strong> {{ reserva.espacio.capacidad }} personas</p>
                            <p><strong>Cantidad solicitada:</strong> {{ reserva.cantidad_personas }} personas</p>
                        </div>
                    </div>
                    <p><strong>Motivo de la reserva:</strong></p>
                    <p style="background: white; padding: 10px; border-radius: 4px;">{{ reserva.motivo }}</p>
                    {% if reserva.fecha_respuesta %}
                    <p><strong>Fecha de respuesta:</strong> {{ reserva.fecha_respuesta|date:"d/m/Y H:i" }}</p>
                    {% endif %}
                    {% if reserva.observaciones_admin %}
                    <p><strong>Observaciones:</strong> {{ reserva.observaciones_admin }}</p>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-data">No hay reservas registradas en el sistema.</p>
    {% endif %}
</div>

<script>
function toggleDetalle(id) {
    var detalle = document.getElementById(id);
    if (detalle.style.display === 'none') {
        detalle.style.display = 'table-row';
    } else {
        detalle.style.display = 'none';
    }
}
</script>

<style>
.data-table td {
    vertical-align: middle;
}
.data-table td:last-child {
    min-width: 200px;
    max-width: 250px;
}
.btn {
    display: inline-block;
    padding: 6px 10px;
    margin: 0;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-size: 12px;
    white-space: nowrap;
}
.btn-success {
    background-color: #27ae60;
    color: white;
}
.btn-info {
    background-color: #3498db;
    color: white;
}
.btn-danger {
    background-color: #e74c3c;
    color: white;
}
.btn-sm {
    padding: 4px 8px;
    font-size: 10px;
}
.btn:hover {
    opacity: 0.9;
}
.badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    white-space: nowrap;
}
.badge-warning {
    background-color: #f39c12;
    color: white;
}
.badge-success {
    background-color: #27ae60;
    color: white;
}
.badge-danger {
    background-color: #e74c3c;
    color: white;
}
.badge-secondary {
    background-color: #95a5a6;
    color: white;
}
</style>
{% endblock %}
