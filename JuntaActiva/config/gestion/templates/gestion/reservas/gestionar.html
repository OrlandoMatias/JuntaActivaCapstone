{% extends 'gestion/base.html' %}

{% block title %}Gestionar Reservas - Sistema de GestiÃ³n Vecinal{% endblock %}

{% block content %}
<div class="content-container">
    <h1>ğŸ¢ Gestionar Reservas de Espacios</h1>
    
    <div style="margin-bottom: 20px;">
        <a href="{% url 'calendario_reservas' %}" class="btn btn-info">ğŸ“… Ver Calendario</a>
    </div>
    
    {% if reservas %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Vecino</th>
                <th>Espacio</th>
                <th>Fecha</th>
                <th>Horario</th>
                <th>Personas</th>
                <th>Estado</th>
                <th>Solicitud</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for reserva in reservas %}
            <tr>
                <td>{{ reserva.vecino.nombre }} {{ reserva.vecino.apellido }}</td>
                <td>
                    {% if reserva.espacio.tipo == 'cancha' %}ğŸ€
                    {% elif reserva.espacio.tipo == 'sala' %}ğŸ¢
                    {% elif reserva.espacio.tipo == 'plaza' %}ğŸŒ³
                    {% endif %}
                    {{ reserva.espacio.nombre }}
                </td>
                <td>{{ reserva.fecha|date:"d/m/Y" }}</td>
                <td>{{ reserva.get_horario_display }}</td>
                <td>{{ reserva.cantidad_personas }}/{{ reserva.espacio.capacidad }}</td>
                <td>
                    {% if reserva.estado == 'pendiente' %}
                        <span class="badge badge-warning">â³ Pendiente</span>
                    {% elif reserva.estado == 'aprobada' %}
                        <span class="badge badge-success">âœ… Aprobada</span>
                    {% elif reserva.estado == 'rechazada' %}
                        <span class="badge badge-danger">âŒ Rechazada</span>
                    {% elif reserva.estado == 'cancelada' %}
                        <span class="badge badge-secondary">ğŸš« Cancelada</span>
                    {% endif %}
                </td>
                <td>{{ reserva.fecha_solicitud|date:"d/m/Y H:i" }}</td>
                <td>
                    <button type="button" class="btn btn-info btn-sm" onclick="verDetalle{{ reserva.id }}()">ğŸ‘ï¸ Ver</button>
                    {% if reserva.estado == 'pendiente' %}
                    <form method="post" action="{% url 'aprobar_reserva' reserva.id %}" style="display: inline;" onsubmit="return confirm('Â¿Aprobar esta reserva?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success btn-sm">âœ… Aprobar</button>
                    </form>
                    <form method="post" action="{% url 'rechazar_reserva' reserva.id %}" style="display: inline;" onsubmit="return confirm('Â¿Rechazar esta reserva?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">âŒ Rechazar</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            <tr id="detalle{{ reserva.id }}" style="display: none;">
                <td colspan="8" style="background: #f8f9fa; padding: 20px;">
                    <h4>Detalles de la Reserva</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <p><strong>Vecino:</strong> {{ reserva.vecino.nombre }} {{ reserva.vecino.apellido }}</p>
                            <p><strong>RUT:</strong> {{ reserva.vecino.rut }}</p>
                            <p><strong>Email:</strong> {{ reserva.vecino.email }}</p>
                            <p><strong>TelÃ©fono:</strong> {{ reserva.vecino.telefono }}</p>
                        </div>
                        <div>
                            <p><strong>Espacio:</strong> {{ reserva.espacio.nombre }}</p>
                            <p><strong>Tipo:</strong> {{ reserva.espacio.get_tipo_display }}</p>
                            <p><strong>Capacidad:</strong> {{ reserva.espacio.capacidad }} personas</p>
                            <p><strong>Cantidad solicitada:</strong> {{ reserva.cantidad_personas }} personas</p>
                        </div>
                    </div>
                    <p><strong>Motivo de la reserva:</strong></p>
                    <p style="background: white; padding: 10px; border-radius: 4px;">{{ reserva.motivo }}</p>
                    {% if reserva.fecha_respuesta %}
                    <p><strong>Fecha de respuesta:</strong> {{ reserva.fecha_respuesta|date:"d/m/Y H:i" }}</p>
                    {% endif %}
                    {% if reserva.observaciones_admin %}
                    <p><strong>Observaciones:</strong> {{ reserva.observaciones_admin }}</p>
                    {% endif %}
                </td>
            </tr>
            <script>
            function verDetalle{{ reserva.id }}() {
                var detalle = document.getElementById('detalle{{ reserva.id }}');
                if (detalle.style.display === 'none') {
                    detalle.style.display = 'table-row';
                } else {
                    detalle.style.display = 'none';
                }
            }
            </script>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-data">No hay reservas registradas en el sistema.</p>
    {% endif %}
</div>

<style>
.btn {
    display: inline-block;
    padding: 8px 16px;
    margin: 2px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-size: 13px;
}
.btn-success {
    background-color: #27ae60;
    color: white;
}
.btn-info {
    background-color: #3498db;
    color: white;
}
.btn-danger {
    background-color: #e74c3c;
    color: white;
}
.btn-sm {
    padding: 6px 12px;
    font-size: 12px;
}
.btn:hover {
    opacity: 0.9;
}
.badge {
    padding: 5px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}
.badge-warning {
    background-color: #f39c12;
    color: white;
}
.badge-success {
    background-color: #27ae60;
    color: white;
}
.badge-danger {
    background-color: #e74c3c;
    color: white;
}
.badge-secondary {
    background-color: #95a5a6;
    color: white;
}
</style>
{% endblock %}
